[{
  "bookSourceGroup": "📓,起点",
  "bookSourceName": "🌈起点助手",
  "bookSourceType": 0,
  "bookSourceUrl": "https://起点助手.luoyacheng.ip-ddns.com",
  "bookUrlPattern": "http://127.0.0.1/qdzs/.*|https://.*qidian.com/book/\\d{5,}/?",
  "concurrentRate": "3/1000",
  "customOrder": 0,
  "enabled": true,
  "enabledCookieJar": true,
  "enabledExplore": true,
  "exploreUrl": "@js:\nlet banben=\"2.0.1\";\nvar obj = {\n\t投资助手: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"①,\"+page)},{\"type\":\"lyc\"}` }}'\n\t\t},\t\n\t盟主排行: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"⑦,\"+page)},{\"type\":\"lyc\"}` }}'\n\t\t\t},\n\t起点榜单: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"△,\"+page)},{\"type\":\"lyc\"}` }}'\n\t\t\t},\n\t大神新书: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"②,\"+page)},{\"type\":\"lyc\"}` }}',\n\t\twb:1\n\t\t\t},\n\t潜力新作: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"③,\"+page)},{\"type\":\"lyc\"}` }}'\n\t\t\t},\n\t新人新书: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"④,\"+page)},{\"type\":\"lyc\"}` }}'\n\t\t\t},\n\t起点首页: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"億,\"+page)},{\"type\":\"lyc\"}` }}',\n\t\twb:1\n\t\t\t},\n\t三江推荐: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"壹,\"+page)},{\"type\":\"lyc\"}` }}'\n\t\t\t},\n\t新书强推: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"贰,\"+page)},{\"type\":\"lyc\"}` }}'\n\t\t\t},\n\t首订数据: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"⑤,\"+page)},{\"type\":\"lyc\"}` }}',\n\t\twb:1\n\t\t\t},\n\t查看书评: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"评,\"+page)},{\"type\":\"lyc\"}` }}'\n\t\t\t},\n\t查看书单: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"单,\"+page)},{\"type\":\"lyc\"}` }}'\n\t\t\t},\n\t'↓　荣誉徽章　↓': {\n\t\turl: '',\n\t\twb:1\n\t\t\t},\n\t荣耀一星: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"Ⅰ,\"+page)},{\"type\":\"lyc\"}` }}',\n\t\twb:1\n\t\t\t},\n\t荣耀二星: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"Ⅱ,\"+page)},{\"type\":\"lyc\"}` }}'\n\t\t\t},\n\t荣耀三星: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"Ⅲ,\"+page)},{\"type\":\"lyc\"}` }}'\n\t\t\t},\n\t荣耀四星: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"Ⅳ,\"+page)},{\"type\":\"lyc\"}` }}',\n\t\twb:1\n\t\t\t},\n\t荣耀五星: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"Ⅴ,\"+page)},{\"type\":\"lyc\"}` }}'\n\t\t\t},\n\t十二天王: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"Ⅻ,\"+page)},{\"type\":\"lyc\"}` }}'\n\t\t\t},\n\t精品频道: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"ⅰ,\"+page)},{\"type\":\"lyc\"}` }}',\n\t\twb:1\n\t\t\t},\n\t一字千金: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"ⅱ,\"+page)},{\"type\":\"lyc\"}` }}'\n\t\t\t},\n\t日更万字: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"ⅲ,\"+page)},{\"type\":\"lyc\"}` }}'\n\t\t\t},\n\t万人追捧: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"ⅳ,\"+page)},{\"type\":\"lyc\"}` }}',\n\t\twb:1\n\t\t\t},\n\t众星捧月: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"ⅴ,\"+page)},{\"type\":\"lyc\"}` }}'\n\t\t\t},\n\t一呼百应: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"ⅵ,\"+page)},{\"type\":\"lyc\"}` }}'\n\t\t\t},\n\t百盟争霸: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"ⅶ,\"+page)},{\"type\":\"lyc\"}` }}',\n\t\twb:1\n\t\t\t},\n\t首订过万: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"ⅷ,\"+page)},{\"type\":\"lyc\"}` }}'\n\t\t\t},\n\t月票第一: {\n\t\turl: '{{`data:page;base64,${java.base64Encode(\"ⅸ,\"+page)},{\"type\":\"lyc\"}` }}'\n\t\t\t}\n\t\n\t}\n\nvar sort = [];\npush = (title, url, size, wrap) => sort.push({\n    \"title\": title,\n    \"url\": url,\n    \"style\": {\n      layout_flexGrow: size || 1,\n      layout_flexBasisPercent: -1,\n      layout_wrapBefore: wrap ? true : false\n     }\n  });\n\nfor (x in obj) {\npush(x, obj[x].url, obj[x].fg, obj[x].wb);\n}\nJSON.stringify(sort);",
  "lastUpdateTime": 0,
  "loginUi": "@js:\n`[\n    {\n        name: \"随机注册\",\n        type: \"button\",\n        action: \"sjzc()\"\n    },\n    \t{\n        name: \"检测月票活动\",\n        type: \"button\",\n        action: \"bfqfun2('月票活动')\"\n    },\n    \t{\n        name: \"本章说\",\n        type: \"button\",\n        action: \"bfqfun2('本章说')\"\n    },\n    \t{\n        name: \"点击作者\",\n        type: \"button\",\n        action: \"zuozhes()\"\n    },\n    \t{\n        name: \"净化正文标题\",\n        type: \"button\",\n        action: \"bfqfun2('净化标题')\"\n    },\n    \t{\n        name: \"段  评\",\n        type: \"button\",\n        action: \"bfqfun2('段评')\"\n    },\n    \t{\n        name: \"更新书源\",\n        type: \"button\",\n        action: \"gengxin()\"\n    },\n    \t{\n        name: \"自动定位首章\",\n        type: \"button\",\n        action: \"bfqfun2('定位首章')\"\n    },\n    \t{\n        name: \"打开起点\",\n        type: \"button\",\n        action: \"dbkid(1)\"\n    },\n    \t{\n        name: \"人气角色\",\n        type: \"button\",\n        action: \"dbkid(2)\"\n    },\n    {\n        name: \"字体颜色\",\n        type: \"text\"\n    },\n    {\n        name: \"调试模式\",\n        type: \"button\",\n        action: \"bfqfun2('调试模式')\",\n        \"style\": {\n            \"layout_flexGrow\": 0,\n            \"layout_flexBasisPercent\": -1\n        }\n    },\n    \t{\n        name: \"${refreshUI()}\",\n        type: \"button\",\n        action: \"refresh()\"\n    },\n    {\n        name: \"限免链接\",\n        type: \"text\"\n    }\n]`",
  "loginUrl": "function zuozhes() {\nlet zzs = source.get('zzs');\nif(zzs!=1){source.put('zzs',1);java.longToast('\\n特性已开启\\n在书籍详情页点击作者名特定搜书\\n附加效果：相同书籍共存');}\nelse{source.put('zzs',0);java.toast('\\n特性已关闭\\n\\n');}\n}\n\nfunction bfqfun2(x) {\nlet xx = source.get('zs'+x);\n//默认关闭\nif(xx!=1) source.put('zs'+x,1),java.toast('🟢已开启 '+x);\nelse source.put('zs'+x,0),java.toast('⚫已关闭 '+x);}\n\nfunction dbkid(x) {\ntry {\nif (!book) throw '请在书籍界面点击';\nvar bkid=book.getVariable(\"bkid\");\nif (bkid.length()<3) throw '未正常获取id';\nif (x==1)\njava.openUrl('qdreader://app/showBook?query={\"bookId\":'+bkid+'}');\nelse if (x==2)\nrqjs(bkid);\n} catch(err) {java.toast(err);}\n}\n\nfunction refresh() {\n\tsource.refreshJSLib();\n\tjava.downloadFile(lycurl);\n\tlet r=eval(java.readTxtFile(java.md5Encode16(lycurl)+'.json')+'')[0];\t\n\tr&&cache.putMemory(lycnm,r);\n\tjava.toast('已手动更新代码');\n}\n\nfunction refreshUI() {\n\tftjs(7);\n\tif (Math.random() < 0.4) gxjslib();\n\treturn '更新代码：'+banben2;\n}\n\r\nfunction login() {}",
  "respondTime": 180000,
  "ruleBookInfo": {
    "author": "au",
    "coverUrl": "cu",
    "init": "@js:\nif (Math.random() < 0.3) gxjslib();\nlet bkid;\nlet bj = java.get('bj');\nif (/^评$/.test(bj)) {\n    let jj = java.get('bkjianjie');\n    //目录链接同书籍链接\n    let tur = book.bookUrl.replace('pe\":\"lyc', 'pe\":\"l');\n    //直接控制简介\n    book.intro = jj;\n    result = {\n        tur: tur\n    };\n\n} else {\n    //搜索跳详情重定向处理\n    let ii = String(book.bookUrl).startsWith('http');\n    if (ii) {\n        bkid = String(book.bookUrl).match(/\\d{5,}(?=\\/?$)/);\n        java.put('bkid', bkid);\n        book.bookUrl = `data:page;base64,${java.base64Encode('https://m.qidian.com/book/'+bkid)},{\"type\":\"lyc\"}`;\n    }\n\n    bkid = java.get('bkid');\n    let rr = cache.getFromMemory('zs' + bkid);\n    let rr2 = cache.get('zss' + bkid);\n    let rr3 = cache.get('zst' + bkid);\n    let url1 = QDSign(\"v3/bookdetail/get\", [\"bookId=\" + bkid, \"isOutBook=0\"]);\n    let url2 = gethd(qdturl + '/info/' + bkid);\n    let url3 = gethd(`https://pre-api.tuishujun.com/api/searchBook?search_value=${book.name}&page=1&pageSize=3`);\n\n    if (!rr) {\n        rr = java.ajax(url1);\n        cache.put('zs' + bkid, rr, 86400);\n    }\n    if (!rr2) {\n        rr2 = java.ajax(url2);\n        rr3 ? cache.put('zss' + bkid, rr2, 86400) :\n            cache.put('zss' + bkid, rr2, 86400 * 2);\n    }\n    if (!rr3) {\n        rr3 = java.ajax(url3);\n        rr3.includes(`\"data\":[]`) ?\n            cache.put('zst' + bkid, rr3, 864000) :\n            cache.put('zst' + bkid, rr3, 864000 * 2);\n    }\n\n    //获取起点图作者\n    let au = gets('class.media-body@tr.1@a.-1@text', rr2);\n    //获取推书君\n    let aly = new JavaImporter(Packages.com.jayway.jsonpath);\n    with(aly) {\n        var jsonp = JsonPath.using(\n            Configuration.builder()\n            .options(Option.SUPPRESS_EXCEPTIONS)\n            .build()\n        ).parse(rr3);\n    }\n    let tsin = jsonp.read(`$..data[?(@.author_nickname==\"${(book.author+'').replace('\\u200b','')||au}\")]['score','score_people_number','first_subscribe']`);\n\n    let tspf = '',\n        tssd = '';\n    if (tsin != '[]') {\n        //评分\n        tsin[0].score_people_number != 0 && (tspf = `\\u200f${tsin[0].score}分 (${tsin[0].score_people_number}人)\n`);\n        //首订\n        (tsin[0].first_subscribe + []).length > 4 && (tssd = `首订：${tsin[0].first_subscribe}\n`);\n    }\n\n    //获取起点图信息\n    //获取收藏数保留一位小数，上千万时不保留\n    let sc = gets('class.media-body@tr.4@text', rr2);\n    sc = (sc.match(/收藏\\D*([\\d\\.w]+)/) || ['', ''])[1].replace(/(\\.\\d)\\d*w/, '$1万').replace(/(\\d{4,})\\.\\d万/, '$1万');\n    //无收藏处理\n    sc == '' ? '' : sc = '收藏:' + sc;\n    //获取封面\n    let cu = 'https://qidian.qpic.cn/qdbimg/349573/' + bkid + '/600';\n    //获取粉丝，新书没有\n    let fs = gets('class.media-body@tr.3@text', rr2);\n    fs = (fs.match(/粉丝\\D*([\\d\\.w]+)/) || ['', ''])[1].replace(/(\\.\\d)\\d*w/, '$1万');\n    if (fs) {\n        fs = '粉丝:' + fs;\n    }\n    //获取盟主，可能没有，标签超额，混入简介\n    let mz = gets('class.media-body@tr.4@text', rr2);\n    mz = (mz.match(/盟主\\D*(\\d+)/) || ['', ''])[1];\n    if (mz) {\n        mz = '本书已有' + mz + '位盟主\\n';\n    }\n\n    java.setContent(rr);\n    //书籍信息\n    //是否存在检查-101\n    let lyc = gets('$.Result');\n    //类型\n    let lx = gets('$.*.BaseBookInfo.CategoryName');\n    //二级分类\n    let lx2 = gets('$.*.BaseBookInfo.SubCategoryName');\n    //推荐\n    let tj = gets('$.*.BaseBookInfo.RecommendAll');\n    //标签，混上起点图\n    //sc = sc>9999 ? \t(sc/10000).toFixed(2)+'万' : sc;\n    tj = tj > 9999999 ? '推荐:' + (tj / 10000).toFixed() + '万' : tj > 9999 ? '推荐:' + (tj / 10000).toFixed(1) + '万' : tj > 0 ? '推荐:' + tj : '';\n    let kd = [lx, tj, sc, fs];\n    //字数\n    let wc = gets('$.*.BaseBookInfo.WordsCnt');\n    //投资\n    let tz = gets('$.*.BaseBookInfo.NewBookInvestCount');\n    tz = tz == -1 ? '' : '已有' + tz + '人投资本书\\n';\n    //状态\n    let zt = gets('$.*.BaseBookInfo.BookStatus');\n    //限免\n    let xm = gets('$.*.BaseBookInfo.FreshManSimple.IsInBlackList');\n    java.put('xm', xm);\n    //最新VIP章节\n    let lcv = gets('$.*.BaseBookInfo.ChapterInfo.LastVipUpdateChapterName');\n    //最新章节\n    let lc = gets('$.*.BaseBookInfo.ChapterInfo.LastUpdateChapterName');\n    //最新时间免费\n    let lct = gets('$.*.BaseBookInfo.ChapterInfo.LastChapterUpdateTime');\n    //最新时间vip\n    let lct2 = gets('$.*.BaseBookInfo.ChapterInfo.LastVipChapterUpdateTime');\n    //采用最新的\n    if (lct2 > lct) {\n        lct = lct2;\n        lc = lcv;\n    }\n    lct = java.timeFormatUTC(lct, \"yyyy年MM月dd日HH:mm\", 288e5);\n    //月票数量\n    let yp = gets('$.*.BaseBookInfo.MonthTicketCount');\n    yp = yp > 9999 ? (yp / 10000).toFixed(1) + '万' : yp;\n    //新建时间\n    let jt = gets('$.*.BaseBookInfo.JoinTime');\n    jt = java.timeFormatUTC(jt, \"yyyy/MM/dd\", 288e5); //HH:mm\n    //简介\n    let jianjie = gets('$.*.BaseBookInfo.Description');\n    //书名\n    let bknm = gets('$.*.BaseBookInfo.BookName');\n\n    //作者名，为空时用起点图\n    au = gets('$.*.AuthorInfo.Author') || au || (book.author + []).replace('\\u200b', '');\n    //特定搜索功能\n    let zzs = source.get('zzs');\n    if (zzs == 1) {\n        au = '\\u200b' + au;\n    }\n    book.author = au; //书架已存在时，改回去会报错\n    //等级，出版书无\n    let aul = gets('$.*.AuthorInfo.AuthorLevel');\n    if (aul) {\n        aul = ` (${aul})`;\n    }\n    //作品数，出版书无\n    let aus = gets('$.*.AuthorInfo.BookCount');\n    aus = aus == 0 ? gets('$..Publisher') : '已有' + aus + '本作品';\n    //作者ID\n    let auid = gets('$.*.AuthorInfo.AuthorId');\n    //作者头像\n    let auim = gets('$.*.AuthorInfo.RealImageUrl');\n    //存头像\n    java.put('auim', auim);\n    //作者简介\n    let aude = gets('$.*.AuthorInfo.AuthorDesc');\n    //存作者说明\n    java.put('aude', aude);\n\n    //书单评论\n    let sdjj = cache.getFromMemory('zsjjl' + bkid) || '';\n    //编写加载简介\n    let it = `${sdjj}${au}${aul} ${aus}\n${tz}${mz}类型：${lx2}\n${tssd}月票：${yp}\n${tspf}\\u202b\\u200f${lct} 更新\n\\u200b\n${jianjie}`; //${jt}\n\n    //不存在时反馈到简介\n    if (lyc < 0) {\n        it = '❗起点反馈：' + gets('$.Message') + '\\n最新：' + book.latestChapterTitle + '\\n本书id：' + bkid;\n        //异常时标记该书,已下架\n        java.put('yxj', 1);\n    }\n\n    //目录链接同书籍链接\n    let tur = book.bookUrl.replace('pe\":\"lyc', 'pe\":\"l');\n    //无脑更新书名\n    book.name = bknm || book.name;\n    //直接控制简介\n    book.intro = it;\n    lc = lc + ' • ' + lct;\n    result = {\n        nm: bknm,\n        au: au,\n        kd: kd,\n        wc: wc,\n        lc: lc,\n        cu: cu,\n        tur: tur\n    };\n}\nresult",
    "kind": "kd",
    "lastChapter": "lc",
    "name": "nm",
    "tocUrl": "tur",
    "wordCount": "wc"
  },
  "ruleContent": {
    "content": "@js:\nlet bkid = book.getVariable('bkid');\n\nlet [, zcid] = chapter.url.match(/^[^\\,]+,([^\\,]+)/);\nzcid = java.base64Decode(zcid);\njava.put(\"cid\", zcid);\nlet uvip = book.getVariable(\"uvip\" + zcid);\nlet bin = book.durChapterIndex;\nlet cin = chapter.index;\nlet tsms = source.get('zs调试模式') == 1;\n\nif (chapter.isVolume()) {\n\t//卷章\n\tlet url1 = QDSign(\"v1/chapterlist/getvolumeinfo\", [\"bookId=\" + bkid, \"volumeCode=\" + zcid]);\n\tresult = java.ajax(url1);\n\tresult = gets('$..VolumeDescription', result);\n}\nelse if (zcid.startsWith('彩')) {\n\t//彩蛋\n\tzcid = zcid.slice(1);\n\tlet url3 = QDSign(\"v3/midpage/pageinfo\", [\"bookId=\" + bkid, \"chapterId=\" + zcid, \"needAdv=0\"]);\n\tresult = java.ajax(url3);\n\tlet rr = '';\n\tlet zssj = cache.get('zssj').split(',');\n\tlet pg = com.jayway.jsonpath.JsonPath.parse(result).read('$..MidPageList[*]');\n\tfor (let cpg of pg) {\n\t\tbook.imageStyle = '';\n\t\tlet sl = com.jayway.jsonpath.JsonPath.parse(cpg);\n\t\tlet pid = (sl.read('$..PageId') + '').slice(1, -1);\n\t\tlet slc = sl.read('$..Widgets[*].Data');\n\t\tfor (let char of slc) {\n\t\t\tlet bt = char.Text;\n\t\t\tlet imu = char.ImgUrl;\n\t\t\tlet viu = char.VideoCoverUrl;\n\t\t\tlet vurl = char.VideoUrl;\n\t\t\tlet [, sid] = (char + '').match(/\\WSourceId\\D+(\\d+)/) || [];\n\n\t\t\tlet type = 3;\n\t\t\tlet ua = `Dalvik/2.1.0 (Linux; U; Android 10; ${zssj[1]} Build/UKQ1.230924.001)`;\n\t\t\tif (viu && vurl != '') {\n\t\t\t\timu = viu;\n\t\t\t\ttype = 1;\n\t\t\t\trr += `\n<img src=\"${imu},{\"headers\":{\"User-Agent\":\"${ua}\"},\"js\":\"videoh('${vurl}','${bt}','${imu}');result\"}\">点击图片，播放视频。`;\n\t\t\t} else {\n\t\t\t\trr += `\n<img src=\"${imu},{\"headers\":{\"User-Agent\":\"${ua}\"}}\">`;\n\t\t\t}\n\n\t\t\tlet url33 = QDSign(\"v1/midpage/danmu/get\", [\"bookId=\" + bkid, \"midpageId=\" + pid, \"resourceId=\" + sid, \"type=\" + type, \"timeAt=0\", \"seconds=10\"]);\n\t\t\tresult = java.ajax(url33);\n\t\t\tlet dmt = '';\n\t\t\tlet dms = jiesuo('', result, '$..Text');\n\t\t\tlet hs = 1, ls = 1, zs = 0;\n\t\t\tlet imt = '';\n\t\t\tlet svg = () => `<svg width=\"1080\" height=\"${hs * 70 + 10}\" xmlns=\"http://www.w3.org/2000/svg\">${imt}</svg>`;\n\t\t\tfor (let dm of dms) {\n\t\t\t\tif (imt == '') imt = `<text fill=\"#${color()}\" opacity=\"0.9\"  dominant-baseline=\"middle\" font-weight=\"bold\" font-size=\"48\">`;\n\t\t\t\tdm = (dm + '').replace(/\\[fn=(\\d+)\\]/g, (x, y) => { return emojisMap[y] });\n\t\t\t\tzs += (Math.random() * 30 | 0) / 10;\n\t\t\t\tzzs = zs + dm.length;\n\t\t\t\tif (zzs > 19) { hs++; zs = (Math.random() * 30 | 0) / 10; }\n\t\t\t\timt += `<tspan x=\"${zs * 60}\" y=\"${hs * 70}\">${dm}</tspan>`;\n\t\t\t\tzs += dm.length;\n\t\t\t\tif (hs > 9) {\n\t\t\t\t\timt += `</text>`;\n\t\t\t\t\tlet img = `<img src=\"data:image/svg+xml;base64,${java.base64Encode(svg())},{\"type\":\"img\"}\">`;\n\t\t\t\t\trr += img;\n\t\t\t\t\ths = 1; zs = 0; imt = '';\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (imt != '') {\n\t\t\t\timt += `</text>`;\n\t\t\t\tlet img = `<img src=\"data:image/svg+xml;base64,${java.base64Encode(svg())},{\"type\":\"img\"}\">`;\n\t\t\t\trr += img;\n\t\t\t}\n\t\t}\n\t}\n\tresult = rr;\n} else if (chapter.isVip() || uvip == '2') {\n\t//VIP章\n\tlet [, cid] = baseUrl.match(/^[^\\,]+,([^\\,]+)/);\n\tcid = java.base64Decode(cid);\n\tlet bkbl = book.getVariable(\"custom\") + '';\n\t//破解方式\n\tlet pjfs = \n\t\t/wxsck.com/.test(bkbl) ? 5 :\n\t\t/libahao.com|^篱笆/.test(bkbl) ? 4 :\n\t\tbkbl.includes(sdgurl)||bkbl.includes(dqurl) ? 3 :\n\t\t/^https?:/.test(bkbl) ? 2 :\n\t\tbkbl.startsWith('笔趣阁') ? 1 : 0;\n\t\tresult = getresult(source.getLoginInfoMap().get('限免链接')+'',book.getVariable('xm'),bkid,zcid);\n\t\tif (result !=='' ) {java.put('xyy', ''); pjfs=-1;}\n\t\tif (pjfs!=0&&cid==zcid&&source.get('zs段评')==1) {\n\t\t\tlet dpurl = QDSign(\"v1/chapterreview/getchapterrepagesummary\", [\"bookId=\" + bkid, \"chapterId=\" + zcid, \"useImei=0\"]);\n\t\t\tlet dprr = jiesuo(dpurl,bkid,0,zcid);;\n\t\t\tjava.put(\"dp\", dprr);\n\t\t\t//段评结束\n\t\t\t}\n\tif (pjfs > 0) {\n\t\t//笔趣阁替换\n\t\t//获取重定向地址头\n\t\tlet cdx = java.get('cdx');\n\t\t//优先69的头，速读谷也需要\n\t\tif (pjfs != 1) cdx = bkbl.match(/http.{4}[^\\/]+/)[0];\n\t\t//访问结果\n\t\tvar pjt = '';\n\t\tlet pjr = book.getVariable(\"zspj\");\n\n\t\tfunction httu(url, fs) {\n\t\t\tlet ck = '';\n\t\t\tif (fs == 3) ck = cookie.getCookie(cdx);\n\t\t\tif (fs == 4) ck = cookie.getCookie(lbhurl);\n\t\t\tlet net = java.connect(gethd(url, ck));\n\t\t\tlet bdy = net.body();\n\t\t\tck = Array.from(\n\t\t\t\tnet.headers()\n\t\t\t\t\t.values(\"Set-Cookie\"))\n\t\t\t\t.map(x => String(x).replace(/;.*/, '')).join('; ');\n\t\t\tif (fs == 4) cookie.replaceCookie(lbhurl, ck);\n\t\t\tif (/^java\\.net|^error/.test(bdy)) bdy = '';\n\t\t\treturn bdy;\n\t\t}\n\n\t\tif (cid == zcid && pjr != '') {\n\t\t\t//第一页\n\t\t\tpjr = org.jsoup.Jsoup.parse(pjr);\n\t\t\tlet ctitle = String(chapter.title);\n\t\t\tvar [, cpx, cnm] = ctitle.split(/^([^章节回]+[章节回]|[^、：]+[、：]|\\d{2,}.)/);\n\t\t\tcpx = cpx.replace(/^\\s+|[\\s、：\\.]+$/g, '');\n\t\t\tcnm = cnm.replace(/^[、\\s]+|\\s+$/g, '');\n\t\t\tcnm || java.log('无标题名，序号为：' + cpx);\n\n\t\t\t//查找章节\n\t\t\tvar pji = pjr.select('a:matchesWholeText(' + cpx + '.*' + cnm + ')').attr('href');\n\t\t\tif (pji == '' && /[（(].*[)）]/.test(cnm)) {\n\t\t\t\t//处理括号干扰\n\t\t\t\tlet cnm2 = cnm.replace(/[（(].*[)）]/g, '.*');\n\t\t\t\ttsms && java.log('匹配0\\n' + cpx + '♦' + cnm2);\n\t\t\t\tpji = pjr.select('a:matchesWholeText(' + cpx + '.*' + cnm2 + ')').attr('href');\n\t\t\t}\n\n\t\t\tlet n1, n2;\n\t\t\tif (pji == '') {\n\t\t\t\t//用新定位限制\n\t\t\t\tlet cdw = book.getVariable('cdw');\n\t\t\t\tcdw = JSON.parse(cdw);\n\t\t\t\tlet index = cdw.findIndex(ob => ob.C == cid);\n\t\t\t\tvar cdwqj = 0;\n\t\t\t\tfor (let i = 0; i < index; i++) {\n\t\t\t\t\t/请假/.test(cdw[i].N) && cdwqj++;\n\t\t\t\t}\n\t\t\t\tn1 = index - 10;\n\t\t\t\tif (n1 < 0) n1 = 0;\n\t\t\t\tn2 = index + 10;\n\t\t\t\ttsms && java.log('匹配1\\n' + cpx + '♦' + cnm + '\\nn1：' + n1 + '，n2：' + n2);\n\t\t\t\tpji = pjr.select(`a:gt(${n1}):lt(${n2}):matchesWholeText([\\\\s章、：\\\\.]${cnm || '洛娅橙lyc'}\\\\s*\\$)`).attr('href');\n\t\t\t}\n\t\t\tif (pji == '' && cnm) {\n\t\t\t\t//可能括号造成的\n\t\t\t\tlet t = '[盟月票谢更求订读粉新]';\n\t\t\t\tlet zz = new RegExp(`[(（].+${t}.*[）)]|[(（].*${t}.+[）)]|【.+${t}.+】`, 'g');\n\t\t\t\tcnm = cnm\n\t\t\t\t\t.replace(zz, '') || '洛娅橙lyc';\n\t\t\t\tn1 = (n1 - 10 < 0) ? 0 : (n1 - 10);\n\t\t\t\tn2 = n2 + 10;\n\t\t\t\ttsms && java.log('匹配2\\n' + cpx + '♦' + cnm + '\\nm1：' + n1 + '，n2：' + n2 + '\\n' + zz);\n\t\t\t\tpji = pjr.select(`a:gt(${n1}):lt(${n2}):matchesWholeText(${cnm}\\\\s*\\$)`).attr('href');\n\t\t\t}\n\t\t\tif (pji == '' && cnm) {\n\t\t\t\t//通匹括号和结尾符号\n\t\t\t\t//构建正则\n\t\t\t\tlet zz = new RegExp('[(（].*[）)]$|【.*】$');\n\t\t\t\tcnm = cnm\n\t\t\t\t\t.replace(zz, '')\n\t\t\t\t\t.replace(/[，。？！…～·、；\\.…\\-\\s]+$/, '') || '洛娅橙橙lyc';\n\t\t\t\tn1 = (n1 - 40 < 0) ? 0 : (n1 - 10 - cdwqj);\n\t\t\t\tn2 = n2 + 10;\n\t\t\t\ttsms && java.log('匹配3\\n' + cpx + '♦' + cnm + '\\nn1：' + n1 + '，n2：' + n2 + '\\n' + zz + '\\n请假条' + cdwqj);\n\t\t\t\tpji = pjr.select(`a:gt(${n1}):lt(${n2}):matchesWholeText(${cnm})`).attr('href');\n\t\t\t}\n\t\t\tif (pji == '') {\n\t\t\t\t//错误率增高\n\t\t\t\tlet cnm1 = (cnm || '标题为空依靠四位序号的情况').match(/[一-ꀀ]+/g);\n\t\t\t\t//构建正则\n\t\t\t\tlet zz = /\\d{4,}|[零一二三四五六七八九十百千万]{4,}/.test(cpx) ? (cpx + '|') : ''; //序号\n\t\t\t\tif (cnm.length > 3) {\n\t\t\t\t\tfor (char of cnm1) zz = zz + char + '.*';\n\t\t\t\t}\n\t\t\t\telse zz = zz + '[\\\\s、：\\.章]' + cnm + '$';\n\t\t\t\tn1 = n1 + 10;//反向提升防匹配旧章节\n\t\t\t\tn2 = n2 + 10;\n\t\t\t\ttsms && java.log('匹配4\\n' + cpx + '♦' + cnm + '\\nn1：' + n1 + '，n2：' + n2 + '\\n' + zz);\n\t\t\t\tpji = pjr.select(`a:gt(${n1}):lt(${n2}):matchesWholeText(${zz})`).attr('href');\n\t\t\t\ttsms && java.log('解锁目录：\\n' + pjr);\n\t\t\t}\n\t\t\tif (pji == '' && cnm) {\n\t\t\t\tn1 = (n1 > 999) ? (n1 - 10) : n1;\n\t\t\t\t//去除感叹词，干扰。极大放宽上限\n\t\t\t\tn2 = n2 + 80;\n\t\t\t\tcnm = cnm.replace(/吧$/, '');\n\t\t\t\tlet zz = /[3456789]\\d{2,}/.test(cpx) ? (cpx + '|') : '';\n\t\t\t\tzz = zz + cnm;\n\t\t\t\ttsms && java.log('匹配5\\n' + cpx + '♦' + cnm + '\\nn1：' + n1 + '，n2：' + n2 + '\\n' + zz);\n\t\t\t\tpji = pjr.select(`a:gt(${n1}):lt(${n2}):matchesWholeText(${zz})`).attr('href');\n\t\t\t}\n\n\t\t\tif (pji == '') {\n\t\t\t\t//获取单章替换内容\n\t\t\t\tpjt = (book.getVariable(\"avip\" + zcid) + '') || 'lyc';\n\t\t\t\tbook.putVariable(\"nurl\" + zcid, nextChapterUrl);\n\t\t\t\t//失败\n\t\t\t} else {\n\t\t\t\t//成功\n\t\t\t\tpji = /^https?:/.test(pji) ? pji : pji.startsWith('//') ? ('https:' + pji) : (cdx + pji);\n\t\t\t\ttsms && java.log(pji);\n\t\t\t\tPackages.java.lang.Thread.sleep(Math.random() * 199 | 0);\n\t\t\t\tpjt = httu(pji, pjfs);\n\t\t\t\tcid = pji;\n\t\t\t\tif (pjt) {\n\t\t\t\t\t//处理繁体\n\t\t\t\t\tif (/69shux\\.co/.test(pji)) pjt = java.t2s(pjt);\n\t\t\t\t\t//标记vip\n\t\t\t\t\tbook.putVariable(\"uvip\" + zcid, 2);\n\t\t\t\t}\n\t\t\t\telse java.log('初次访问正文失败');\n\t\t\t}\n\n\t\t\t//第一页结束\n\t\t} else if (pjr == '') {\n\t\t\t//无解锁目录\n\t\t\tpjt = '';\n\t\t} else {\n\t\t\t//下一页链接访问内容\n\t\t\tlet tim = Math.floor(Math.random() * 1399);\n\t\t\tPackages.java.lang.Thread.sleep(tim);\n\t\t\tpjt = httu(cid, pjfs);\n\t\t\tif (!pjt) java.log('正文下一页访问失败');\n\t\t}\n\n\t\tlet xyy = '';\n\t\tif (pjt == '') { result = ''; }\n\t\telse if (pjt == 'lyc') {\n\t\t\tresult = '';\n\t\t\tif (bin == cin) java.toast('\\n《' + book.name + '》\\n' + chapter.title + '\\n暂未解锁');\n\t\t}\n\t\telse {\n\t\t\tjava.setContent(pjt);\n\t\t\tif (pjfs == 1) {\n\t\t\t\txyy = gets('text.下一@href');\n\t\t\t\tif (xyy.includes('_')) xyy = cdx + xyy;\n\t\t\t\telse xyy = '';\n\t\t\t\tresult = gets('#chaptercontent@html');\n\t\t\t} else if (pjfs == 2) {\n\t\t\t\t//69的正文匹配\n\t\t\t\tresult = java.getElement('.content||.txtnav||.contxt||#txtcontent||#txtright');\n\t\t\t\tif (result == '' && bin == cin) java.toast('\\n69正文链接访问异常');\n\t\t\t\tresult.select('script, h1, .txtinfo, .chase-book-btn').remove();\n\t\t\t} else if (pjfs == 3) {\n\t\t\t\txyy = gets('text.下一页@href');\n\t\t\t\tif (xyy.includes('-')) xyy = cdx + xyy;\n\t\t\t\telse xyy = '';\n\t\t\t\t//速读谷正文\n\t\t\t\tresult = java.getElement('.con');\n\t\t\t\tif (result == '' && bin == cin) java.toast('\\n速读谷/得奇正文链接访问异常');\n\t\t\t} else if (pjfs == 4) {\n\t\t\t\t//篱笆好\n\t\t\t\txyy = gets('a:matchesWholeOwnText(^下一页)@href');\n\t\t\t\tlet xyy2 = xyy.match(/\\d+\\/\\d+/) || '';\n\t\t\t\tif (cid.includes(xyy2)) {\n\t\t\t\t\tif (/_\\d+\\.html/.test(xyy)) xyy = cdx + xyy;\n\t\t\t\t\telse xyy = '';\n\t\t\t\t\tresult = java.getElement('#chapterContent');\n\t\t\t\t\tresult.select('a').remove();\n\t\t\t\t\tif (result == '' && bin == cin) java.toast('\\n篱笆好正文链接访问异常');\n\t\t\t\t} else { java.toast('\\n篱笆好资源暂未更新'); result = xyy = ''; }\n\t\t\t}\n\t\t\telse if (pjfs == 5) {\n\t\t\t\t//万相书城\n\t\t\t\txyy = gets('a:contains(下一页)@href');\n\t\t\t\tif (xyy.includes('_')) xyy = cdx + xyy;\n\t\t\t\telse xyy = '';\n\t\t\t\tresult = gets('#cont-body@html');\n\t\t\t\t\n\t\t\t\t} else { java.toast('❌'); }\n\n\t\t\t//格式html，方便净化\n\t\t\tresult = java.htmlFormat(gets('@html', result));\n\t\t\tresult = String(result);\n\t\t}\n\t\t//下一页\n\t\tjava.put('xyy', xyy);\n\n\t\tif (pjfs == 1) {\n\t\t\t//笔趣阁净化\n\t\t\tresult = result.replace(/\\s*（.*阅读模式.*）\\s*|\\s*请收藏.*\\.(?:com|cc|icu|cfd)/g, '').replace(/([一-ꀀ])$/, '$1🎭');\n\t\t} else if (pjfs == 2) {\n\t\t\t//69书吧净化\n\t\t\tlet z1 = '[一⊥]+';\n\t\t\tlet zz = new RegExp(`^[^，。？“”]{0,19}[6六]${z1}[9九]${z1}书${z1}吧[^，。？“”]{0,9}\\$`, 'gm');\n\t\t\tresult = result.replace(zz, '');\n\t\t\t//69繁体站\n\t\t\tif (/69shux\\.co/.test(pji)) {\n\t\t\t\tlet z2 = `[^\\\\sa-z，。？！：；…～“”、（）—‘’·《》￥〈〉【】〖〗『』「」．,?!:;…~'\"一-ꀀ]|[乂爪]`;\n\t\t\t\tlet z3 = \"\\\\.*\";\n\t\t\t\tlet zz = new RegExp(`请${z3}您${z3}收${z3}藏${z3}6${z3}9${z3}书${z3}吧${z3}！|(?:${z2})(?:${z2}|[^\\\\S\\\\n]){6,}|^[^，。？“”]{0,9}首${z1}发${z1}内${z1}容[^，。？“”]{0,19}\\$`, 'gmi');\n\t\t\t\tresult = result.replace(zz, '');\n\t\t\t}\n\t\t} else if (pjfs == 4) {\n\t\t\t//篱笆好净化\n\t\t\t//\tlet fh=String.raw`[一-ꀀ\\s“‘，。？！：；…—～~、’”\"']`;\n\t\t\tlet l1 = \"(?:篱|li).{0,2}\",\n\t\t\t\tl2 = \"(?:笆|ba).{0,2}\",\n\t\t\t\tl3 = \"(?:好|hao).{0,2}\",\n\t\t\t\tl4 = \"(?:[文吻]|wen).{0,2}\",\n\t\t\t\tl5 = \"(?:学|xue).{0,2}\",\n\t\t\t\tl6 = \"(?:[好文吻学]|hao|wen|xue).{0,2}\";\n\t\t\tlet zz = new RegExp(String.raw`([^一-ꀀ])(?:</.{0,2})?(?:${l1 + l2}(?:${l6}){0,3}|${l2 + l3}(?:${l6}){0,2}|${l3 + l4}(?:${l6})?|${l4 + l5})$|${l1 + l2 + l3}(?:${l6}){0,2}$|</.{0,2}[篱笆好文学]>$`, 'gmi');\n\t\t\tresult = result.replace(zz, '$1');\n\t\t}\n\n\t\t//净化标题\n\t\tlet jh = source.get('zs净化标题');\n\t\tif (jh == 1 && cnm && result) {\n\t\t\tlet zz = new RegExp(String.raw`^\\s*(?:${book.name}.*)?(?:</ins>\\s*)?.{0,19}${cnm}(?:.{0,9}(?:[（(【].{0,39}[】)）])?\\n)?`);\n\t\t\tresult = result.replace(zz, '');\n\t\t}\n\t\t//pjfs>0结束\n\t}\n\t//付费章节结束\n}\nelse {\n\t//免费章节\n\tlet url2 = QDSign(\"v2/bookcontent/safegetcontent\", [\"bookId=\" + bkid, \"chapterId=\" + zcid, \"fineLayout=0\"]).split(/^([^,]+),/);\n\t//url2=QDSign(\"v4/bookcontent/getvipcontent\",[\"b=\"+bkid,\"c=\"+zcid,\"ui=0\",\"b-string=\"]);\n\tlet byt = '', zwr = '';\n\ttry {\n\t\t//下架书籍不访问加密链接\n\t\tif (java.get('yxj') == 1) url2 = ['', '', ''];\n\t\tbyt = java.get(url2[1], JSON.parse(url2[2]).headers).bodyAsBytes();\n\n\t\t//解密\n\t\tzwr = ZWjj(byt, zcid);\n\t} catch (err) {\n\t\t//VIP的情况为403，否则提示出错\n\t\tif (String(err).includes('Status=403')) {\n\t\t\t//直接用付费链接再访问\n\t\t\turl2 = QDSign(\"v2/subscription/getvipprice\", [\"bookId=\" + bkid, \"chapterId=\" + zcid, \"fineLayout=0\"]).split(/^(.+?),/);\n\t\t\tbyt = java.get(url2[1], JSON.parse(url2[2]).headers).body();\n\t\t\tzwr = `{Content:'${gets('$..Summary', byt)}'}`;\n\t\t\tbook.putVariable(\"uvip\" + zcid, 2);\n\t\t} else {\n\t\t\tjava.longToast('💔访问加密链接异常');\n\t\t\tjava.log('解密异常日志：\\n' + err);\n\t\t\tbook.putVariable(\"uvip\" + zcid, '');\n\t\t\tzwr = \"{}\";\n\t\t}\n\n\t}\n\n\tif (zcid < 0) {\n\t\t//扉页\n\t\tbook.imageStyle = '';\n\t\t//获取头像\n\t\tlet auim = String(java.get('auim')).replace(/100$/, '200');\n\t\t//获取作者简介\n\t\tlet aude = java.get('aude');\n\t\tif (aude.length() > 0)\n\t\t\taude = aude\n\t\t\t\t.replaceAll(',', '，').replaceAll('。，', '。')\n\t\t\t\t.replaceAll('作品，著有', '、') + '。';\n\t\tlet atw = gets('$..AuthorWords', zwr);\n\t\tlet bks = gets('$..BookStatus', zwr);\n\t\tlet lx = gets('$..CategoryName', zwr);\n\t\tlet zs = gets('$..WordsCnt', zwr);\n\t\tlet zsz = '万字';\n\t\tif (zs > 999999) zs = (zs / 10000).toFixed(0);\n\t\telse if (zs > 99999) zs = (zs / 10000).toFixed(1);\n\t\telse if (zs > 9999) zs = (zs / 10000).toFixed(2);\n\t\telse zsz = '字';\n\t\tlet zz = gets('$..Author', zwr);\n\t\tlet sj = gets('$..PunishTime', zwr);\n\t\tlet tag = gets('$..Tags..Name', zwr).replaceAll('\\n', '　');\n\t\tlet hz = (aude + tag).length;\n\t\ttag = hz < 39 ? tag + \"\\n\\u200b\\n\".repeat(3) :\n\t\t\thz < 50 ? tag + \"\\n\\u200b\\n\".repeat(2) :\n\t\t\t\thz < 99 ? tag + \"\\n\\u200b\\n\" : tag + \"\\n\";\n\t\tlet bkurl = String(book.bookUrl).replace(/.+,(.+),.+/, '$1');\n\t\tresult = zwzs(bkid, zcid, [auim, aude, atw, bks, lx, zs, zsz, zz, sj, tag, bkurl]);\n\n\t} else {\n\t\t//正常免费章\n\t\t//获取图片\n\t\tlet imu = com.jayway.jsonpath.JsonPath.read(zwr, '$..Blocks[*]');\n\t\tresult = gets('$..Content', zwr);\n\t\tlet dpkg = source.get('zs段评') == 1;\n\t\tlet tpxs = imu != [];\n\t\tif (dpkg||tpxs) result = String(result).split(/\\r?\\n/);\n\t\tif (dpkg) {\n\t\tlet dpurl = QDSign(\"v1/chapterreview/getchapterrepagesummary\", [\"bookId=\" + bkid, \"chapterId=\" + zcid, \"useImei=0\"]);\n\t\tlet dprr = jiesuo(dpurl,bkid,0,zcid);\n\t\ttry {result = dpcl(dprr, result);} catch(e) {java.longToast('段评加载异常');java.log('段评加载异常'+e);}\n\t\t//段评结束\n\t\t}\n\n\t\tif (tpxs) {\n\t\t\tfor (let ii = 0; ii < imu.length; ii++) {\n\t\t\t\tlet i = imu[ii].Attach;\n\t\t\t\tlet zssj = cache.get('zssj').split(',')[1];\n\t\t\t\tresult[i] = `<img src=\"${imu[ii].Url},{User-Agent:'Dalvik/2.1.0 (Linux; U; Android 10; ${zssj} Build/UKQ1.230924.001)'}\">` + (result[i] || '');\n\t\t\t}\n\t\t//图片结束\n\t\t}\n\t\tif (dpkg||tpxs) {\n\t\tlet s = '';\n\t\tresult.forEach(x => { s += x + '\\n' });\n\t\tresult = s;\n\t\t}\n\t}\n\t//净化正版\n\tresult = result.replace(/(，[一-ꀀ]+)\\n/, '$1。\\n');\n\t//免费章节结束\n}\nresult",
    "nextContentUrl": "@js:\nvar xyy=java.get('xyy');\nif (xyy=='') result=[];\nelse\nresult=`data:page;base64,${java.base64Encode(xyy)},{\"type\":\"lyc\"}` ;",
    "payAction": "//破解，获取书籍变量\nlet bkbl = book.getVariable(\"custom\")+[];\nresult = 3;\njava.toast('稍等');\nresult=jiesuo(bkbl);\nif (result==='')\njava.longToast('\\n请到起点APP观看');\n\nif (result > 1) {\nlet bknm=String(book.name);\nlet bkau=String(book.author).replace('\\u200b','');\n//搜索\nlet pjs = loading(bknm);\nlet pjl = pjs.find(x => x.articlename==bknm && x.author==bkau);\nPackages.java.lang.Thread.sleep(300);\n\n//目录链接，改。没有，不加载\nif (pjl) {\njava.toast('\\n已找到相应书籍');\nlet head={\n\t'User-Agent': u_a,\n\t'Accept-Language': a_l,\n\t'Referer': s__u\n};\n\nlet s__us=[\"96fd80d.sbs\",\"15d476280.xyz\",\"b26d7.icu\",\"86f2a.cfd\",\"e191e0efa5.cfd\"];\n\nlet ii=s__us[0];\nlet urls=s__us.reverse();\nlet aly = new JavaImporter(\n\tPackages.org.jsoup.Jsoup,\n\tPackages.org.jsoup.Connection);\nfor(let url of urls) {\n\tlet i=0;\n\ttry {\n\twith (aly) {\n\t\ti=Jsoup.connect('https://m.'+url+'/favicon.ico')\n.timeout(1200)\n.ignoreContentType(true)\n.followRedirects(false)\n.method(Connection.Method.HEAD)\n.execute().statusCode()\n\t}\n\tif (i>199&&i<400) {ii=url;java.toast('访问目录页'); break;}\n\t} catch(err) {java.toast('\\n'+url+'\\n无法访问，尝试下一个');}\n}\nlet ck1= 'getsite='+ii;\n\nlet pjml=gethd(s__u+String(pjl.url_list).replace(/read/,\"userverify/$&\")+'list.html',ck1);\nlet pjr = java.ajaxAll([pjml])[0];\n\nlet pp = pjr.url();\nbook.putVariable(\"cdx\", pp.match(/https:\\/\\/[^\\/]+/)[0]);\npjr = org.jsoup.Jsoup.parse(pjr.body());\npjr = pjr.select('dl dd~dd a');\nlet pjrcd=pjr.length;\nif (pjrcd>book.totalChapterNum*3/5) {\n\tjava.log('解锁结果：\\n'+pjr);\n\tbook.putVariable(\"zspj\",pjr);\n\tbook.putCustomVariable('笔趣阁：'+pp);\n\tjava.toast('笔趣阁解锁成功');\n\tresult=1;\n\t} else {\n\t\tjava.log('内容过少，解锁地址：\\n'+pjml);\n\t\tjava.longToast('😫结果只有'+pjrcd+'章');\n\t\tresult=0;\n\t\t}\n} else {java.toast('笔趣阁解锁失败');result=0;}\n//笔趣阁if结束\n}\nresult",
    "replaceRegex": "##🎭(?:\\n|$)|\\(本章完\\)(?:$|<img)@js:\nlet dprr = java.get(\"dp\");\nif (dprr.length() > 0) {\n    result = String(result).split(/\\r?\\n/);\n    try {\n        result = dpcl(dprr, result);\n    } catch (e) {\n        java.longToast('段评加载异常');\n        java.log('段评加载异常' + e);\n    }\n    let s = '';\n    result.forEach(x => {\n        s += x + '\\n'\n    });\n    result = s;\n}\nlet zcid = java.get('cid');\nif (source.get('zs本章说') == 1 && !zcid.startsWith('彩') && !chapter.isVolume() && result)\n    result += zwzs(java.get('bkid'), zcid);\nresult",
    "title": "@js:java.get('btdp')"
  },
  "ruleExplore": {
    "author": "<js>\nlet bj=java.get('bj');\n//访问起点\nif (/^[^⑤⑥评单△壹贰]$/.test(bj)) {\n\tlet bkid = java.get('bkid');\n\tvar re=cache.get('zs'+bkid);\n\tlet tm=100; //最低延时\n\tif (!re) {\n\tlet url=QDSign(\"v3/bookdetail/get\", [\"bookId=\"+bkid,\"isOutBook=0\"]);\n\tre = java.ajax(url);\n\t//防止访问频繁\n\tlet ppage=cache.getFromMemory('zsfxpage')||1;\n\ttm = ppage<7 ? ppage*100 : 10;\n\tcache.put('zs'+bkid,re,8640);}\n\tPackages.java.lang.Thread.sleep(tm); //防止过快响应导致page变化没跟上（仍有极低概率）\n\t}\n\nif (bj=='①'||bj=='②') {\n\tresult = gets('td.1@a.0@text');\n\t}\nelse if (/^[③④⑥⑦]$/.test(bj)) {\n\tresult = gets('td.3@a.0@text');\n\t}\nelse if (bj=='⑤') {\n\tresult = gets('td.7@a.0@text');\n\t}\nelse if (/^[ⅠⅡⅢⅰⅱⅲⅳⅴⅵⅶⅷⅸ]$/.test(bj)) {\n\tresult = gets('$.*.AuthorInfo.Author',re);\t\n\t}\nelse if (/^[ⅣⅤ]$/.test(bj)) {\n\tresult = gets('td.4@a.0@text');\n\t}\nelse if (/^[Ⅻ]$/.test(bj)) {\n\tresult = gets('td.5@a.0@text');\n\t}\nelse if (/^[億]$/.test(bj)) {\n\tresult = gets('td.2@a.0@text');\n\t}\nelse if (/^[评单△壹贰]$/.test(bj)) {\n\tresult=gets('$.AuthorName||BookAuthor||Author');\n\t}\n\nif(source.get('zzs')==1) result='\\u200b'+result;\nresult\n</js>",
    "bookList": "@js:\nlet ly = java.hexDecodeToString(src).split(',');\nlet bj=ly[0],ppage = ly[1];\ncache.putMemory('zsfxpage',ppage);\nlet url=qdturl+'/';\nlet ysr='';\nswitch(String(bj)) {\n\tcase '①': url=gethd(url+'touzi/');break;\n\tcase '②': url=gethd(url+'dashenxinshu/');break;\n\tcase '③': url=gethd(url+'qianli/');break;\n\tcase '④': url=gethd(url+'qianlilv1/');break;\n\tcase '⑤': \n\tif (ppage==1) try {\n\t\tlet svg=`<svg width=\"990\" height=\"300\" xmlns=\"http://www.w3.org/2000/svg\">\n<text font-size=\"50\" fill=\"#${color()}\" text-anchor=\"middle\" dominant-baseline=\"middle\" stroke=\"#161823\" stroke-width=\"1\" font-weight=\"bold\">\n<tspan x=\"50%\" y=\"30%\" font-size=\"100\">\n输入查询的时间\n</tspan>\n<tspan x=\"50%\" y=\"60%\">\n例如25 2、2024-01-15等\n</tspan>\n</text>\n</svg>`;\n\t\tysr=java.getVerificationCode(`data:image/svg+xml;base64,${java.base64Encode(svg)}`);\n\t\tysr=(ysr+'').replace(/^\\d{0,2}(\\d{2})\\D(\\d{1,2})\\D?(\\d{1,2})?$/, (mt, p1, p2, p3)=>{\n\t\t\tp1=p1<30?('20'+p1):'2025';\n\t\t\tp2=p2<13?p2.padStart(2, '0'):'02';\n\t\t\tp3=p3<32?('-'+p3.padStart(2, '0')):'';\n\t\t\treturn p1+'-'+p2+p3;\n\t\t\t});\n\t\t\tif (!/^\\d{4}-[\\d\\-]{2,5}$/.test(ysr)) ysr='';\n\t\t} catch(err) {ysr='';}\n\t\turl=gethd(url+'shouding/'+ysr);\n\t\tbreak;\n\tcase '⑦': url=gethd(url+'reader/');break;\n\tcase 'Ⅰ': url=gethd(url+'badge/rongyao_1');break;\n\tcase 'Ⅱ': url=gethd(url+'badge/rongyao_2');break;\n\tcase 'Ⅲ': url=gethd(url+'badge/rongyao_3');break;\n\tcase 'Ⅳ': url=gethd(url+'badge/rongyao_4');break;\n\tcase 'Ⅴ': url=gethd(url+'badge/rongyao_5');break;\n\tcase 'Ⅻ': url=gethd(url+'badge/twelvekings');break;\n\tcase 'ⅰ': url=gethd(url+'badge/jingpinpindao');break;\n\tcase 'ⅱ': url=gethd(url+'badge/rijindoujin');break;\n\tcase 'ⅲ': url=gethd(url+'badge/rigengwanzi');break;\n\tcase 'ⅳ': url=gethd(url+'badge/wanrenzhuipeng');break;\n\tcase 'ⅴ': url=gethd(url+'badge/xiezhulongen');break;\n\tcase 'ⅵ': url=gethd(url+'badge/wanzhongyixin');break;\n\tcase 'ⅶ': url=gethd(url+'badge/baimengzhengba');break;\n\tcase 'ⅷ': url=gethd(url+'badge/shoudingguowan');break;\n\tcase 'ⅸ': url=gethd(url+'badge/yuepiaodiyi');break;\n\tcase '壹': url=QDSign(\"v1/booksquare/getsjrecommend\",[\"groupId=1\",\"pageIndex=\"+ppage]);break;\n\tcase '贰': url=QDSign(\"v1/booksquare/getsjrecommend\",[\"groupId=4\",\"pageIndex=\"+ppage]);break;\n\tcase '億': \n\t\tlet tm = java.timeFormatUTC(Date.now(),\"yyyy-MM-dd\",28800000-2*60*60*1000);\n\turl=gethd(url+'bang/1/'+tm);break;\n\tcase '评':\n\tif (ppage==1) {try {\n\t\tlet svg=`<svg width=\"990\" height=\"300\" xmlns=\"http://www.w3.org/2000/svg\">\n<text font-size=\"50\" fill=\"#${color()}\" text-anchor=\"middle\" dominant-baseline=\"middle\" stroke=\"#161823\" stroke-width=\"1\" font-weight=\"bold\">\n<tspan x=\"50%\" y=\"30%\" font-size=\"100\">\n请输入书籍ID\n</tspan>\n<tspan x=\"50%\" y=\"60%\">\n可在书籍详情页复制\n</tspan>\n</text>\n</svg>`;\n\t\tysr=java.getVerificationCode(`data:image/svg+xml;base64,${java.base64Encode(svg)}`);\n\t\tysr=ysr.match(/\\d{3,}/)[0];\n\t\tif (!ysr) throw 'empty';\n\t\t} catch(err) {ysr='';}\n\t\tsource.put('zsysr',ysr);}\n\telse ysr=source.get('zsysr');\n\tif (ysr!='') {\t\t\n\t\turl=QDSign(\"v1/booklist/getrelation\",[\"bookId=\"+ysr,\"page=\"+ppage,\"size=20\",\"type=2\",\"isRecommended=1\"]);\n\t\t} else url='';\n\t\tbreak;\n\tcase '单':\n\tif (ppage==1) {try {\n\t\tlet svg=`<svg width=\"990\" height=\"300\" xmlns=\"http://www.w3.org/2000/svg\">\n<text font-size=\"50\" fill=\"#${color()}\" text-anchor=\"middle\" dominant-baseline=\"middle\" stroke=\"#161823\" stroke-width=\"1\" font-weight=\"bold\">\n<tspan x=\"50%\" y=\"30%\" font-size=\"100\">\n请输入书单ID\n</tspan>\n<tspan x=\"50%\" y=\"60%\">\n可通过 查看书评 获得\n</tspan>\n<tspan x=\"50%\" y=\"90%\" font-size=\"40\">\n为空时使用随机书单\n</tspan>\n</text>\n</svg>`;\n\t\tysr=java.getVerificationCode(`data:image/svg+xml;base64,${java.base64Encode(svg)}`);\n\t\tysr=ysr.match(/\\d{3,}/)[0];\n\t\tif (!ysr) throw '0';\n\t\t} catch(err) {\n\t\t\tlet tt=Math.random()*9|0;\t\n\t\t\tlet url=qdturl+'/booklists/'+(tt?(tt+'/'):'');\n\t\t\tlet rr=java.ajax(gethd(url));\n\t\t\trr=(rr+'').match(/booklist\\/\\d{3,}/g);\n\t\t\ttt=Math.random()*rr.length|0;\n\t\t\tysr=rr[tt].match(/\\d{3,}/)[0];}\n\t\tsource.put('zsysr',ysr);}\n\telse ysr=source.get('zsysr');\n\tif (ysr!='') {\n\t\turl=QDSign(\"v1/booklist/getBookListDetail\",[\"bookListId=\"+ysr,\"page=\"+ppage,\"size=20\",\"selectedBookId=0\"]);\n\t\t} else url='';\n\t\tbreak;\n\tcase '△':\n\tif (ppage==1) {\n\ttry {\n\tvar webr=java.startBrowserAwait('https://qdzs.lyc','选择分类',false,html()).body();\n\t} catch(err) {if (err.message.includes('验证结果为空')) webr=html();}\n\tlet flfl1=gets('#flfl1@text',webr);\n\tlet flfl2=gets('#flfl2@text',webr);\n\tsource.put('zsysr',[flfl1,flfl2]);\n\t}\n\t\tlet [flfl1,flfl2]=source.get('zsysr').split(',');\n\t\tif (/年榜月票$/.test(flfl1)) {\n\t\t\turl=QDSign(\"v2/historyBooks/get\",[\"site=11\",\"topId=0\",\"monthId=0\",\"categoryId=-1\",\"version=\",\"pageIndex=\"+ppage,\"pageSize=20\"]);\n\t\t\t}\n\t\telse {\n\t\tflfl1=duiz1[flfl1];\n\t\tflfl2=duiz2[flfl2]||\"-1\";\n\turl=QDSign(\"v3/topBooks/get\",[\"site=11\",\"topId=\"+flfl1,\"categoryId=\"+flfl2,\"version=\",\"pageIndex=\"+ppage,\"pageSize=20\"]);}\n\t\tbreak;\n\tdefault: url='';}\n\n//访问\nif (/^[评单△壹贰]$/.test(bj)) {\n\tif (url=='') {result=[{}];} else {\n\t\tresult = java.ajax(url);\n\t\tjava.setContent(result);\n\t\tresult = java.getElement('$.Data[\"BookLists\",\"Books\",\"RankBookList\",\"BookList\",\"BookInfos\"][*]');}\n\t}\nelse {\n\nif (ppage ==1 ) {\n\tif (/^\\d+-\\d+$/.test(ysr)) {\tbj = '⑥';}\n\telse if (/^\\d{4}\\-\\d{2}\\-\\d{2}$|^$/.test(ysr)) {}\n\telse {url='';\n\tPackages.java.lang.Thread.sleep(500);\n\tjava.longToast('\\n请输入正确格式的时间');}\n\tresult = java.ajax(url);\n\tresult = org.jsoup.Jsoup.parse(result);\n\tresult.select('tr:has(#ad-slot),head').remove();\n\tresult=result.select('tbody tr');\n\tcache.put('qdzsrs',`<table>${result}</table>`);}\n\t\n\tresult = cache.get('qdzsrs');\n\tresult = org.jsoup.Jsoup.parse(result);\n\tif (bj=='⑤'||bj=='⑥') {\n\t\tresult = ppage>1 ? [] : result.select('tr');}\n\telse {\n\t\t// java.log('p'+ppage); //快速翻页时概率page不变\n\t\tresult = result.select(`tr:eq(${ppage-1})`);}\n}\n\n\njava.put('bj',bj);\nresult",
    "bookUrl": "<js>\nlet bj=java.get('bj');\nif (bj=='①'||bj=='②')\nresult = gets('td.0@a.1@href');\nelse result = 'https://m.qidian.com/book/'+java.get('bkid');\n`data:page;base64,${java.base64Encode(result)},{\"type\":\"lyc\"}` \n</js>",
    "coverUrl": "<js>\nlet bj=java.get('bj');\nif (/^评$/.test(bj)) {\nlet time=gets('$.UpdateTime');\ntime=java.timeFormat(time);\nlet sc=gets('$.CollectCount');\nsc = sc>9999 ?\n'⭐ '+(sc/10000).toFixed(1)+'万' :\nsc>9 ?\n'⭐ '+sc :\n'';\nlet cf='';\ntry {\n\tcf=source.getLoginInfoMap().get('字体颜色');\n\tif (cf=='') throw '空';\n\t} catch(cerr) {cf='f2fdff';}\nlet svg = `<svg width=\"600\" height=\"800\" xmlns=\"http://www.w3.org/2000/svg\">\n<text fill=\"#${cf}\" text-anchor=\"middle\" dominant-baseline=\"middle\" stroke=\"#161823\" stroke-width=\"1\" font-weight=\"bold\">\n<tspan x=\"50%\" y=\"10%\" font-size=\"80\">\n${time}\n</tspan>\n<tspan x=\"50%\" y=\"50%\" font-size=\"90\">\n${sc}\n</tspan>\n</text>\n</svg>`;\nsvg=java.base64Encode(svg);\nresult='data:image/svg+xml;base64,'+svg;\n} else {\nlet bkid = java.get('bkid');\nresult='https://qidian.qpic.cn/qdbimg/349573/'+bkid+(/^[⑤⑥评单△壹贰]$/.test(bj)?'/180':'/600');}\n\nresult\n</js>",
    "intro": "<js>\nlet bj=java.get('bj');\nif (bj=='⑤') {\n\tresult = java.getStringList('td.4@b@ownText&&td[6]@ownText');\n\tlet vtm=gets('td.-1@value');\n\tresult = '粉丝:'+result[1]+'\\n收订比:'+result[0]+'\\n首V时刻:'+vtm;\n}\nelse if (bj=='⑥') {\n\tresult = java.getStringList('td.-3@b@ownText&&td.-4@ownText');\n\tlet vtm=gets('td.-1@value');\n\tresult = '粉丝:'+result[1]+'\\n收订比:'+result[0]+'\\n首V时刻:'+vtm;\n}\nelse if (/^评$/.test(bj)) {\n\tlet jj=gets('$.Des');\n\tlet sl=gets('$.BookCount');\n\tlet bkid = java.get('bkid');\n\tresult=gets('$.BookIntroWords');\n\tjj='书评：\\n'+result+'\\n\\u200b\\n\\u200b\\n书单介绍：\\n\\u200f本书单（'+bkid+'）有'+sl+'本书\\n\\u200b\\n'+jj;\n\tjava.put('bkjianjie',jj);\n\t}\nelse if (/^单$/.test(bj)) {\n\tresult=gets('$.BookIntroWords');\n\tlet bkid = java.get('bkid');\tcache.putMemory('zsjjl'+bkid,'书评：\\n'+result+'\\n\\u200b\\n\\u200b\\n');\n\t}\nelse if (/^[△壹贰]$/.test(bj)) {\n\t\tresult=gets('$.Description');\n\t\tif (!result) {\n\t\t\tlet bkid = java.get('bkid');\n\t\t\tlet rr = cache.get('zs'+bkid);\t\n\t\t\tresult = rr&&gets('$.*.BaseBookInfo.Description',rr);}\n\t}\nelse {\n\tlet bkid = java.get('bkid');\n\tresult = cache.get('zs'+bkid);\t\n\tresult = gets('$.*.BaseBookInfo.Description',result).replaceAll('\\n','　');\n}\nresult\n</js>",
    "kind": "<js>\nlet bj=java.get('bj');\nif (bj=='①'||bj=='②') {\n\tresult = java.getStringList('td[0,2,4,5]@ownText');\n\t//收藏数\n\tlet sc = result[2];\n\tsc = sc>9999 ? \t(sc/10000).toFixed(1)+'万' : sc;\n\t//推荐数\n\tlet bkid = java.get('bkid');\n\tlet rr = cache.get('zs'+bkid);\t\n\t\tlet tj = gets('$.*.BaseBookInfo.RecommendAll',rr);\n\ttj = tj>9999 ? \t'△'+(tj/10000).toFixed(1)+'万' : '△'+tj;\n\tresult = [result[0].match(/^\\[(.+)\\]/)[1],result[1],`${tj}`,`☆${sc}`];\n\t}\nelse if (bj=='③'||bj=='④') {\n\tresult = java.getStringList('td[1,2,3,5]@ownText');\n\tresult = [result[1].slice(1,-1),result[2].slice(1,-1),'◎'+result[0],'☆'+result[3].replace('w','万')];\n\t//去除无意义1级\n\tif (bj=='④') result.splice(1,1);\n\t}\nelse if  (bj=='⑤') {\n\tresult = java.getStringList('td[1,3,7]@ownText');\n\tlet vv = gets('td.2@b@ownText||td.2@font@ownText');\n\tresult = [result[0].slice(1,-1),result[2],'📌'+vv,'☆'+result[1].replace('w','万')];\n\t}\nelse if  (bj=='⑥') {\n\tresult = java.getStringList('td[1,4,5]@ownText');\n\tlet vv = gets('td.2@b@ownText||td.2@font@ownText');\n\tresult = [result[0].slice(1,-1),result[1],'📌'+vv,'☆'+result[2].replace('w','万')];\n\t}\nelse if  (bj=='⑦') {\n\tlet pm = java.getStringList('td[0,1]@text');\n\tlet bkid = java.get('bkid');\n\tresult = cache.get('zs'+bkid);\t\n\tlet lx=gets('$.*.BaseBookInfo.CategoryName',result);\n\tlet aul=gets('$.*.AuthorInfo.AuthorLevel');\n\tlet tj=gets('$.*.BaseBookInfo.RecommendAll',result);\n\ttj = tj>9999 ? \t'△'+(tj/10000).toFixed(1)+'万' : '△'+tj;\n\tresult=['#'+pm[0],pm[1],lx,aul,tj];\n\t}\nelse if (/^[ⅠⅡⅢⅰⅱⅲⅳⅴⅵⅶⅷⅸ]$/.test(bj)) {\n\t//起点数据\n\tlet bkid = java.get('bkid');\n\tresult = cache.get('zs'+bkid);\t\n\tlet lx=gets('$.*.BaseBookInfo.CategoryName',result);\n\tlet aul=gets('$.*.AuthorInfo.AuthorLevel',result);\n\tlet tj=gets('$.*.BaseBookInfo.RecommendAll',result);\n\ttj = tj>9999 ? \t'△'+(tj/10000).toFixed(2)+'万' : tj>0 ? '△'+tj : '';\n\tresult=[lx,aul,tj];\n\t}\nelse if  (/^[ⅣⅤ]$/.test(bj)) {\n\tresult = java.getStringList('td[1,2,3]@ownText');\n\tresult = [result[0].slice(1,-1),result[2],'粉丝:'+result[1].replace('w','万')];\n\t}\nelse if  (bj=='Ⅻ') {\n\tresult = java.getStringList('td[1:4]@ownText');\n\tresult = [result[0],result[1].slice(1,-1),result[3],'粉丝:'+String(result[2]).replace(/\\dw$/,'万')];\n\t}\nelse if  (bj=='億') {\n\tresult = java.getStringList('td[1,3,4,5]@ownText');\n\t\tlet sc = result[2];\n\tsc = sc>9999 ? \t(sc/10000).toFixed(1)+'万' : sc;\n\tlet fs = result[3];\n\tfs = fs>9999 ? \t(fs/10000).toFixed(1)+'万' : fs;\n\t\n\tresult = [result[0].slice(1,-1),result[1],`☆${sc}`,`粉丝:${fs}`];\n\t}\nelse if (/^[评单]$/.test(bj)) {\n\tresult='';\n\t}\nelse if (/^[△壹贰]$/.test(bj)) {\n\tlet non=gets('$.TopNo');\n\tlet yps=gets('$.ExtraValue');\n\typs = yps>9999 ? (yps/10000).toFixed(2)+'万票,' : yps>0 ? yps+'票,' : '';\n\tresult=(non?'#'+non+',':'')+yps+gets('$.CategoryName');\n\t}\n\nresult\n</js>",
    "lastChapter": "<js>\nlet bj=java.get('bj');\nif (/^[①②ⅠⅡⅢⅣⅤⅰⅱⅲⅳⅴⅵⅶⅷⅸ]$/.test(bj))\nresult = gets('td.-1@text');\nelse result='';\nresult\n</js>",
    "name": "<js>\ntry{\nlet bj=java.get('bj');\nlet bkid;\nif (/^[①②ⅠⅡⅢⅰⅱⅲⅳⅴⅵⅶⅷⅸ]$/.test(bj)) {\n\tresult = gets('td.0@a.0@text');\n\tbkid = gets('td.0@a.0@href');\n\t}\nelse if (/^[③④⑦Ⅻ]$/.test(bj)) {\n\tresult = gets('td.2@a.0@text');\n\tbkid = gets('td.2@a.0@href');\n\t}\nelse if (/^[⑤⑥ⅣⅤ億]$/.test(bj)) {\n\tresult = gets('td.1@a.0@text');\n\tbkid = gets('td.1@a.0@href');\n\t}\nelse if (/^[评单△壹贰]$/.test(bj)) {\n\tresult=gets('$.Name||BookName');\n\tbkid = gets('$.Id||BookId');\n\t}\n\tjava.put('bkid',String(bkid).match(/\\d{5,}/)[0]);\n} catch(err) {result='';}\nresult\n</js>",
    "wordCount": "<js>\nlet bj=java.get('bj');\nif (bj=='①'||bj=='②') {\n\tresult = gets('td.3@text');\n\t}\nelse if (bj=='③'||bj=='④') {\n\tresult = gets('td.4@text');\n\t}\nelse if (bj=='⑤') {\n\tresult = gets('td.5@text');\n\t}\nelse if (bj=='⑥') {\n\tresult = gets('td.-2@text');\n\t}\nelse if (bj=='億') {\n\tresult = gets('td.-1@text');\n\t}\nelse if (/^[⑦ⅠⅡⅢⅣⅤⅫⅰⅱⅲⅳⅴⅵⅶⅷⅸ]$/.test(bj)) {\n\tlet bkid = java.get('bkid');\n\tresult = cache.get('zs'+bkid);\t\n\tresult = gets('$.*.BaseBookInfo.WordsCnt',result);\t\n\t}\nelse if (/^[评单]$/.test(bj)) {\n\tresult='';\n\t}\nelse if (/^[△壹贰]$/.test(bj)) {\n\tresult=gets('$.WordsCount');\n\t}\nif (/[Ww]$/.test(result)) {\n\tresult = (+result.slice(0,-1)*1e4|0)+'';\n\t}\nresult\n</js>"
  },
  "ruleSearch": {
    "author": "<js>\nlet ss=cache.getFromMemory('qdts');\nif (ss!=0&&ss<999) {\n\tgets('td.0@a.-1@text')\n\t}  else {gets('$..AuthorName')}\n</js>",
    "bookList": "@js:\ngxjslib();\nlet ss=cache.getFromMemory('qdts');\nif  (ss==0) {\nresult=java.getElement(\"$..CardList..ItemData[?(@.BookType==1)]\");\nresult.length==0&&(result=java.getElement(\"$..Data.Items[*]\"));\n}\n\telse if (ss==1||ss==1000) {\n\t cache.putMemory('qdzss',result);\n\t }\n\telse {\n\t\t\tlet re=cache.getFromMemory('qdzss');\n\t\t\tjava.setContent(re);\n\t\t\t}\n\nif (ss!=0) {\n\t//至少为6本才触发自动加载\n\tlet sss=(ss-1)*6;\n\tif (ss<999)\n\t\tresult = java.getElement('class.media['+sss+':'+(sss+5)+']@table@tbody');\n\t\telse\nresult=java.getElements('$.Data.RoleList[*]&&$..SimpleBooks[*]&&$.Data.SimpleBookInfoPageList[*]');\n\t}\nresult",
    "bookUrl": "<js>\n`data:page;base64,${java.base64Encode('https://m.qidian.com/book/'+java.get('bkid'))},{\"type\":\"lyc\"}` \n</js>",
    "checkKeyWord": "@唐三",
    "coverUrl": "<js>\nlet bkid=java.get('bkid');\n'https://qidian.qpic.cn/qdbimg/349573/'+bkid+'/600'\n</js>",
    "intro": "<js>\nlet ss=cache.getFromMemory('qdts');\nif (ss!=0&&ss<999) {\n\tlet bkid = java.get('bkid');\n\tresult = cache.get('zs'+bkid);\t\n\tresult = gets('$.*.BaseBookInfo.Description',result).replaceAll('\\n','　');\n\t}  else {result=gets('$..Description')}\nresult\n</js>",
    "kind": "<js>\nlet ss=cache.getFromMemory('qdts');\n\nif (ss!=0&&ss<999) {\n\tlet bkid = java.get('bkid');\n\tlet re=cache.get('zs'+bkid);\n\tif (!re) {\n\tlet url=QDSign(\"v3/bookdetail/get\", [\"bookId=\"+bkid,\"isOutBook=0\"]);\n\tre = java.ajax(url);\n\tcache.put('zs'+bkid,re,8640);\n\t//防止访问过于频繁\n\tPackages.java.lang.Thread.sleep(ss*100);\n\t}\n\t\n\t\t//起点数据\n\tlet lx=gets('$.*.BaseBookInfo.CategoryName',re);\n\tlet aul=gets('$.*.AuthorInfo.AuthorLevel',re);\n\tlet tj=gets('$.*.BaseBookInfo.RecommendAll',re);\n\t//推荐，可能书不存在\n\ttj = tj>9999 ? \t'△'+(tj/10000).toFixed(2)+'万' : tj>0 ? '△'+tj : tj;\n\t//起点图数据\n\tlet sc = gets('td.3@text').match(/收藏\\D*([\\dw\\.]+)/)[1].replace('w','万');\n\t\t//首订，可能没有\n\t\t\tlet sd = gets('td.3@text').match(/首订\\D*([\\d]+)/);\n\t\t\t\tsd = sd ? '📌' + sd[1] : '';\n\t\n\tresult=[lx,aul,sd,tj,'☆'+sc];\n\t}  else if (ss!=0) {\n\t\tresult=gets('$.RoleName&&Position&&ActionStatusString');\n\t\t} else {result=gets('$..CategoryName');}\nresult\n</js>",
    "lastChapter": "<js>\nlet ss=cache.getFromMemory('qdts');\nif (ss!=0&&ss<999) {\n\tgets('td.-1@text')\n\t}  else {''}\n</js>",
    "name": "<js>\nlet ss=cache.getFromMemory('qdts');\nlet bkid;\nif (ss!=0&&ss<999) {\n\tbkid = String(gets('td.0@a.0@href')).match(/\\d{5,}/)[0];\n\tresult=gets('td.0@a.0@text');\n\t}  else {\n\t\tbkid = gets('$..BookId');\n\t\tresult=gets('$..BookName');\n\t\tif (!bkid) {bkid=\"000\";result=\"作者\";java.put('bj','人');}\n\t\t}\njava.put('bkid',bkid);\nresult\n</js>",
    "wordCount": "<js>\nlet ss=cache.getFromMemory('qdts');\nif (ss!=0&&ss<999) {\n\tgets('td.2@text').match(/字数\\D*([\\dw\\.]+)/)[1].replace('w','万')\n\t}  else {gets('$..WordsCount')}\n</js>"
  },
  "ruleToc": {
    "chapterList": "@js:\nlet tim = Math.floor(Math.random()*91);\nPackages.java.lang.Thread.sleep(tim);\n//处理起点\nlet bkid = java.get('bkid');\nlet yxj = java.get('yxj');\nlet bj=java.get('bj');\nlet xms=0;\nif (/^评$/.test(bj)) {\n\tresult=[{\"N\":\"没有章节\",\"C\":486}];}\nelse if (yxj!=1) {\n\t\n//获取详情\nlet rr=cache.get('zs'+bkid); //内存缓存文件\nif (!rr) {\n\tlet url0=QDSign(\"v3/bookdetail/get\",[\"bookId=\" + bkid,\"isOutBook=0\"]);\n\tlet zustime3 = cache.getFromMemory('zustime');\nif (zustime3<Date.now()) zustime3=Date.now();\nzustime3+=300;\ncache.putMemory('zustime',zustime3);\nwhile(Date.now()<zustime3) {\n\tPackages.java.lang.Thread.sleep(300);}\n\trr=java.ajax(url0);\n\tPackages.java.lang.Thread.sleep(500);}\n\n//最新时间免费\nlet lct=gets('$.*.BaseBookInfo.ChapterInfo.LastChapterUpdateTime',rr);\n//最新时间vip\nlet lct2=gets('$.*.BaseBookInfo.ChapterInfo.LastVipChapterUpdateTime',rr);\nif (lct2>0) book.putVariable(\"vip\",1); //标记vip\n//采用最新的\nif (lct2>lct) lct=lct2;\nlet xme=gets('$.*.BaseBookInfo.LimitEnd',rr);\nif (xme>0) {\njava.toast(`\n《${book.name}》限免中\n结束时间：${java.timeFormatUTC(xme,\"yyyy-MM-dd HH:mm\",8*36e5)}`);\nxms=gets('$.*.BaseBookInfo.LimitStart',rr);\nxms=java.timeFormatUTC(xms,\"yyyy-MM-dd HH:mm\",-40*36e5);} else xms=0;\nlet bklst = java.get('bklst');\nlet bklsr = java.get('bkmlr');\n//开始分逻辑\nif (bklst==lct && bklsr!='') {\n\tresult=JSON.parse(bklsr);\n\t//无新章节\n\t} else {\n\t//原逻辑\ncache.put('zs'+bkid,rr,3600*8); //一天三次\nlet url11=QDSign(\"v3/chapterlist/chapterlist\",[\"bookId=\"+bkid,\"timeStamp=0\",\"requestSource=0\",\"md5Signature=\",\"extendchapterIds=\"]);\nresult=jiesuo(url11,bkid);\nlet zustime = cache.getFromMemory('zustime');\nif (zustime<Date.now()) zustime=Date.now();\nzustime+=300;\ncache.putMemory('zustime',zustime);\nwhile(Date.now()<zustime) {\n\tPackages.java.lang.Thread.sleep(300);}\nlet rr0=[{\"C\":-10000,\"N\":\"版权信息\",\"uuid\":-1}];\nlet rr1= com.jayway.jsonpath.JsonPath.parse(result).read('$.data.vs[*]');\nlet Void=200;\nfor (let char of rr1) {\n\tlet r0={};\n\tlet n=char.wC;\n\tlet Von=char.vN;\nif (char.vN==\"作品相关\") {r0.C=100;}\nelse if (Void==200) {r0.C=Void;Void=80000;}\nelse {r0.C=Void++;}\n\tr0.N=Von;\n\tr0.T=`共${char.cCnt}章 ${n>9999?(n/10000).toFixed(1)+'万字':n+'字'}`;\n\tr0.Vo=1;\n\trr0.push(r0);\n\tlet css=char.cs;\n\tfor (let cs of css) {\n\t\tlet r0={};\n\t\tr0.C=cs.id;r0.N=cs.cN;\n\t\tr0.T=cs.uT+\" \"+cs.cnt+\"字\";\n\t\tr0.V=1-cs.sS;\n\t\tr0.uuid=cs.uuid;\n\t\trr0.push(r0);\n\t\t}\n}\nbook.putVariable('cdw',JSON.stringify(rr0));\n\n//获取彩蛋章\nlet url2=QDSign(\"v1/midpage/book/chapters\",[\"bookId=\"+bkid]);\n\tresult = java.ajax(url2);\n\tjava.setContent(result);\n\tlet rr2=java.getElement('$.*.Chapters[*]');\nfor (let char of rr2) {\n\tlet cidc = char.ChapterId;\n\tlet ind = rr0.findIndex(x => x.C == cidc);\n\tchar.C='彩'+cidc;\tchar.T=java.timeFormatUTC(char.MidpageList[0].UpdateTime,\"yyyy-MM-dd HH:mm\",8*36e5);\t\nchar.N=Array.from(char.MidpageList).map(x=>x.MidpageName).join(\" \");\n\tif (ind>0) rr0.splice(ind+1,0,char); //没找到的表示已删除\n\t}\n\n//定位\nif (source.get('zs定位首章')==1) {\nlet ind = rr0.findIndex(x=>x.C==200);\nif (!book.durChapterIndex) book.durChapterIndex=ind+1;}\nresult=rr0;\nbook.putVariable('bkmlr',JSON.stringify(result));\nbook.putVariable('bklst',lct);\n//原逻辑结束\n}\n\n//月票检测\nlet yp = source.get('zs月票活动');\nif (yp=='1'&&book.order!=0) {\n\t//获取活动\nlet url3=QDSign(\"v1/fund/activitylistdetail\",[\"bookId=\" + bkid,\"pg=1\",\"pz=20\"]);\nlet zustime2 = cache.getFromMemory('zustime');\nif (zustime2<Date.now()) zustime2=Date.now();\nzustime2+=300;\ncache.putMemory('zustime',zustime2);\nwhile(Date.now()<zustime2) {\n\tPackages.java.lang.Thread.sleep(300);}\nlet rr3=java.ajax(url3);\nlet sz = lookyp(rr3);\nif (sz.length>0) looky(sz);\n}\n\n} else {\n\t//下架书\n\tresult=[{\"N\":\"已下架\",\"C\":486}];}\n\nlet bkbl = book.getVariable(\"custom\")+[];\nresult.map(x=>{\nif (x.V==1) {\n\tlet uvip=String(book.getVariable(\"uvip\"+x.C));\n\tif (bkbl&&uvip!='') x.V=0;}\nx.C=\"data:;base64,\"+java.base64Encode(x.C)+',{\"type\":\"lyc\"}';\nreturn x});",
    "chapterName": "N",
    "chapterUrl": "C",
    "isVip": "V",
    "isVolume": "Vo",
    "updateTime": "T"
  },
  "searchUrl": "@js:\n/*\n搜索时，可输入@后加上条件进行筛选或者按要求排序。支持输入书籍id\n目前可选条件有：完本，连载，3更 ，7更，30更，免费，精品，30万字，30-50万字，50-100万字，100-200万字，50万字，100万字，200万字\n可选排序有：默认，更新，推荐，月票，收藏，字数\n//解释：3更，指3天内有更新；30万字，指30万字以内；免费和精品无法同时起效；推荐，指按推荐票数量排序\n//举例：“重生@免费”，“系统@30万字@免费”，“我的@月票@精品”\n*/\nif (/^\\u200b|^：/.test(key)) {\n\tif (page==1) {\n\t\tresult = gethd(qdturl+'/author/'+key.slice(1));} else {\n\t\t\tresult='data:;base64,MQ,{\"type\":\"lyc\"}';}\n\t\t\t//作者搜索\n\t\t\tcache.putMemory('qdts',page);\n\t}\nelse if (/\\d{5,}$/.test(key)) {\n\t\tlet bkid = key.match(/\\d+$/)[0];\n\t\t//跳详情页\n\t\tresult = 'http://127.0.0.1/qdzs/'+bkid;\n\t\t}\nelse if (/^@@/.test(key)) {\n\tcache.putMemory('qdts',page*1000);\n\tif (page==1)\n\tresult = QDSign(\"v1/booksearch/autocomplete\",[\"siteId=1\",\"keyword=\"+key.slice(2),\"count=20\"]);\n\telse result='data:;base64,QQ,{\"type\":\"lyc\"}';\n}\nelse if (/^@/.test(key)) {\n\t//角色\n\tcache.putMemory('qdts',0);\n\tresult=QDSign(\"v2/booksearch/searchRoleBooks\",[\"pageIndex=\"+page,\"roleName=\"+key.slice(1),\"pageSize=10\"]);\n} else {\ncache.putMemory('qdts',0);\nlet sz = key.split(\"@\");\n//带符号可使自动排序失效\nlet kk = sz.shift().replace(/^[#＃]/,'');\nlet re = ['keywordType=1','siteId=1','keyword='+kk,'pageIndex='+page,'pageSize=20'];\n\nlet book_zt = book_px = \"\";\nbook_zt = sz.includes(\"完本\")\n? \"actionstatus=1,\"\n:sz.includes(\"连载\")\n? \"actionstatus=2,\"\n:sz.includes(\"3更\")\n? \"actionstatus=3,\"\n:sz.includes(\"7更\")\n? \"actionstatus=4,\"\n:sz.includes(\"30更\")\n? \"actionstatus=5,\"\n:\"\"\nbook_zt += sz.includes(\"200万字\")\n? \"wordscount=1,\"\n:sz.includes(\"100万字\")\n? \"wordscount=2,\"\n:sz.includes(\"50万字\")\n? \"wordscount=3,\"\n:sz.includes(\"100-200万字\")\n? \"wordscount=4,\"\n:sz.includes(\"50-100万字\")\n? \"wordscount=5,\"\n:sz.includes(\"30-50万字\")\n? \"wordscount=6,\"\n:sz.includes(\"30万字\")\n? \"wordscount=7,\"\n:\"\"\nbook_zt += sz.includes(\"免费\")\n? \"paidmode=1,\"\n:sz.includes(\"精品\")\n? \"paidmode=3,\"\n:\"\"\nbook_px = sz.includes(\"默认\")\n? \"=11\"\n:sz.includes(\"更新\")\n? \"=1\"\n:sz.includes(\"推荐\")\n? \"=2\"\n:sz.includes(\"月票\")\n? \"=4\"\n:sz.includes(\"收藏\")\n? \"=3\"\n:sz.includes(\"字数\")\n? \"=6\"\n:\"\"\nbook_px==\"\" ? '' : re.push(\"order\"+book_px);\nbook_zt==\"\" ? '' : re.push(\"filters=\"+book_zt.slice(0,-1));\n\nresult = QDSign(\"v2/booksearch/searchbooks\",re);}\nPackages.java.lang.Thread.sleep(300);\nresult",
  "variableComment": "源变量：权限密码\n书籍变量：解锁使用网站的目录链接\n",
  "weight": 0
}]